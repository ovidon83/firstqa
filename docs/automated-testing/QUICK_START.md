# Automated Testing - Quick Start Guide

## ğŸš€ 5-Minute Setup

### 1. Install Dependencies (Already Done)
```bash
npm install
```
Dependencies installed: `playwright`, `@playwright/test`, `form-data`, `@octokit/auth-app`

### 2. Install Chromium Browser (Already Done)
```bash
npx playwright install chromium
```

### 3. Configure Environment Variables

Add to your `.env` file:

```bash
# Enable automated testing
TEST_AUTOMATION_ENABLED=true

# Your staging/test environment URL
TEST_AUTOMATION_BASE_URL=https://staging.yourdomain.com

# GitHub App credentials (for Checks API)
GITHUB_APP_ID=your-app-id
GITHUB_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----"
```

### 4. Test the Setup

```bash
npm run test:automation
```

Expected output:
```
âœ… All checks passed! Automated testing is ready to use.
```

### 5. Open a PR

When you open a PR:
1. Ovi AI generates test recipe
2. Automated tests execute in browser
3. GitHub Check Run shows status
4. PR comment posts detailed results with video

---

## ğŸ“‹ What Happens Automatically

### When PR is Opened:
1. **AI Analysis** - Ovi AI analyzes PR and generates test recipe
2. **Check Run Created** - GitHub shows "Ovi AI - Automated Tests" in progress
3. **Tests Execute** - Playwright runs tests in real browser
4. **Video Recorded** - Full test session captured
5. **Screenshots Taken** - Each test scenario gets screenshot
6. **Check Run Updated** - âœ… or âŒ status shown in PR
7. **Comment Posted** - Detailed results with video and screenshots

### PR Comment Includes:
- âœ… Pass/Fail summary
- ğŸ“Š Test coverage by priority
- ğŸ¥ Full video with timestamps
- ğŸ“¸ Screenshots for each test
- ğŸ› Detailed failure information
- ğŸ“‹ Console logs and network errors
- ğŸ’¡ Actionable recommendations

---

## ğŸ¯ Example Test Flow

### 1. Test Recipe (Generated by AI)
```json
{
  "scenario": "User login with valid credentials",
  "priority": "Happy Path",
  "steps": "1. Navigate to /login\n2. Enter test@example.com\n3. Enter password\n4. Click Login",
  "expected": "User redirected to dashboard"
}
```

### 2. AI Converts to Playwright
```javascript
[
  {"type": "navigate", "url": "/login"},
  {"type": "type", "selector": "input[name='email']", "value": "test@example.com"},
  {"type": "type", "selector": "input[name='password']", "value": "password123"},
  {"type": "click", "selector": "button:has-text('Login')"}
]
```

### 3. Executes in Browser
- Opens Chromium
- Performs actions
- Records video
- Takes screenshots
- Verifies results

### 4. Reports Results
- Updates GitHub Check
- Posts PR comment
- Includes video/screenshots

---

## âš™ï¸ Configuration Options

### Basic (Recommended)
```bash
TEST_AUTOMATION_ENABLED=true
TEST_AUTOMATION_BASE_URL=https://staging.yourdomain.com
```

### Advanced
```bash
# Only run tests on PRs with specific label
TEST_AUTOMATION_TRIGGER_LABELS=run-tests,automated-qa

# Browser settings
TEST_AUTOMATION_HEADLESS=true      # false to see browser window
TEST_AUTOMATION_SLOW_MO=100        # Slow down actions (ms)
TEST_AUTOMATION_TIMEOUT=30000      # Action timeout (ms)

# Recording
TEST_AUTOMATION_RECORD_VIDEO=true
TEST_AUTOMATION_SCREENSHOTS=true
```

---

## ğŸ” Debugging

### View Test Results Locally
After test execution, check:
```
test-results/
  â””â”€â”€ [execution-id]/
      â”œâ”€â”€ results.json          # Full results
      â”œâ”€â”€ full-test-run.webm    # Video recording
      â””â”€â”€ screenshots/          # All screenshots
```

### Watch Tests in Action
```bash
# In .env, set:
TEST_AUTOMATION_HEADLESS=false
TEST_AUTOMATION_SLOW_MO=500
```

### Check Logs
```bash
npm start
# Look for:
# ğŸ¤– Automated testing is enabled for this PR
# ğŸ¬ Starting test execution
# âœ… Test execution completed
```

---

## ğŸš¨ Troubleshooting

### Tests Not Running?
1. Check `TEST_AUTOMATION_ENABLED=true`
2. Verify `TEST_AUTOMATION_BASE_URL` is accessible
3. Review server logs for errors

### Tests Failing?
1. Watch the video recording to see what happened
2. Check screenshots for visual issues
3. Review console logs in PR comment
4. Verify staging environment is up

### No Video/Screenshots?
1. Check disk space
2. Verify `TEST_AUTOMATION_RECORD_VIDEO=true`
3. Check write permissions on `test-results/` directory

---

## ğŸ“š Next Steps

- âœ… **Test locally**: Run `npm run test:automation`
- âœ… **Enable on staging**: Set `TEST_AUTOMATION_BASE_URL`
- âœ… **Open test PR**: See it in action
- âœ… **Review results**: Check GitHub Checks and PR comments
- âœ… **Customize**: Adjust settings as needed

---

## ğŸ’° Cost Estimate

Per PR (with ~10 test scenarios):
- **OpenAI API**: ~$0.01-0.05 (GPT-4o for test conversion)
- **Storage**: ~50-100MB (video + screenshots)
- **Server**: Uses existing infrastructure
- **Total**: ~$0.01-0.05 per PR

---

## ğŸ‰ You're Ready!

Automated testing is now set up. Open a PR and watch Ovi AI execute your tests automatically!

Need help? Check the [full documentation](./README.md) or [contact support](mailto:support@firstqa.dev).

